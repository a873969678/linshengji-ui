(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["linshengji"]=e():t["linshengji"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="9986")}({"7d2e":function(t,e,n){"use strict";var i=n("f0d8"),s=n.n(i);s.a},9986:function(t,e,n){"use strict";var i;(n.r(e),"undefined"!==typeof window)&&(n("e67d"),(i=window.document.currentScript)&&(i=i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(n.p=i[1]));var s=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},o=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"linshengji-code"},[n("div",{staticClass:"container"},[n("div",{attrs:{id:"captcha"}}),n("div",{attrs:{id:"msg"}})])])}],r={name:"LinshengjiCode",props:{success:{type:Function,default:()=>{}},width:{type:Number,default:300},height:{type:Number,default:150},title:{type:String,default:"向右滑动滑块填充拼图"}},data(){return{}},mounted(){this.start()},methods:{resets(){var t=document.getElementById("captcha");while(t.hasChildNodes())t.removeChild(t.firstChild);this.start(),this.success(!1)},start(){const t=this;function e(){document.getElementById("msg").innerHTML="",t.success(!1)}(function(e){const n=42,i=10,s=t.width,o=t.height,r=Math.PI,c=n+2*i;function a(t,e){return Math.round(Math.random()*(e-t)+t)}function l(t,e){const n=u("canvas");return n.width=t,n.height=e,n}function d(t){const e=u("img");return e.crossOrigin="Anonymous",e.onload=t,e.onerror=()=>{e.src=p()},e.src=p(),e}function u(t){return document.createElement(t)}function h(t,e){t.classList.add(e)}function f(t,e){t.classList.remove(e)}function p(){const t=["https://picsum.photos/300/150/?image=1001","https://picsum.photos/300/150/?image=1002","https://picsum.photos/300/150/?image=1003","https://picsum.photos/300/150/?image=1004","https://picsum.photos/300/150/?image=1005","https://picsum.photos/300/150/?image=1006"],e=Math.floor(6*Math.random());return t[e]}function m(t,e,s,o){t.beginPath(),t.moveTo(s,o),t.lineTo(s+n/2,o),t.arc(s+n/2,o-i+2,i,0,2*r),t.lineTo(s+n/2,o),t.lineTo(s+n,o),t.lineTo(s+n,o+n/2),t.arc(s+n+i-2,o+n/2,i,0,2*r),t.lineTo(s+n,o+n/2),t.lineTo(s+n,o+n),t.lineTo(s,o+n),t.lineTo(s,o),t.fillStyle="#fff",t[e](),t.beginPath(),t.arc(s,o+n/2,i,1.5*r,.5*r),t.globalCompositeOperation="xor",t.fill()}function g(t,e){return t+e}function y(t){return t*t}class v{constructor({el:t,onSuccess:e,onFail:n,onRefresh:i}){this.el=t,this.onSuccess=e,this.onFail=n,this.onRefresh=i}init(){this.initDOM(),this.initImg(),this.draw(),this.bindEvents()}initDOM(){const e=l(s,o),n=e.cloneNode(!0),i=u("div"),r=u("div"),c=u("div"),a=u("div"),d=u("span"),h=u("span"),f=document.getElementsByClassName("linshengji-code")[0];f.style.cssText=`width:${t.width}px;position: relative`,n.className="block",i.className="sliderContainer",i.style.cssText=`width:${t.width}px`,r.className="refreshIcon",c.className="sliderMask",a.className="slider",d.className="sliderIcon",h.innerHTML=t.title,h.className="sliderText";const p=this.el;p.appendChild(e),p.appendChild(r),p.appendChild(n),a.appendChild(d),c.appendChild(a),i.appendChild(c),i.appendChild(h),p.appendChild(i),Object.assign(this,{canvas:e,block:n,sliderContainer:i,refreshIcon:r,slider:a,sliderMask:c,sliderIcon:d,text:h,canvasCtx:e.getContext("2d"),blockCtx:n.getContext("2d")})}initImg(){const t=d(()=>{this.canvasCtx.drawImage(t,0,0,s,o),this.blockCtx.drawImage(t,0,0,s,o);const e=this.y-2*i+2,n=this.blockCtx.getImageData(this.x,e,c,c);this.block.width=c,this.blockCtx.putImageData(n,0,e)});this.img=t}draw(){this.x=a(c+10,s-(c+10)),this.y=a(10+2*i,o-(c+10)),m(this.canvasCtx,"fill",this.x,this.y),m(this.blockCtx,"clip",this.x,this.y)}clean(){this.canvasCtx.clearRect(0,0,s,o),this.blockCtx.clearRect(0,0,s,o),this.block.width=s}bindEvents(){this.el.onselectstart=()=>!1,this.refreshIcon.onclick=()=>{this.reset(),"function"===typeof this.onRefresh&&this.onRefresh()};let t="",e="";const n=[];let i=!1;this.slider.addEventListener("mousedown",(function(n){t=n.x,e=n.y,i=!0})),document.addEventListener("mousemove",o=>{if(!i)return!1;const r=o.x-t,c=o.y-e;if(r<0||r+38>=s)return!1;this.slider.style.left=r+"px";var a=(s-40-20)/(s-40)*r;this.block.style.left=a+"px",h(this.sliderContainer,"sliderContainer_active"),this.sliderMask.style.width=r+"px",n.push(c)}),document.addEventListener("mouseup",e=>{if(!i)return!1;if(i=!1,e.x===t)return!1;f(this.sliderContainer,"sliderContainer_active"),this.trail=n;const{spliced:s,TuringTest:o}=this.verify();s?o?(h(this.sliderContainer,"sliderContainer_success"),"function"===typeof this.onSuccess&&this.onSuccess()):(h(this.sliderContainer,"sliderContainer_fail"),this.text.innerHTML="再试一次",this.reset()):(h(this.sliderContainer,"sliderContainer_fail"),"function"===typeof this.onFail&&this.onFail(),setTimeout(()=>{this.reset()},1e3))})}verify(){const t=this.trail,e=t.reduce(g)/t.length,n=t.map(t=>t-e),i=Math.sqrt(n.map(y).reduce(g)/t.length),s=parseInt(this.block.style.left);return{spliced:Math.abs(s-this.x)<10,TuringTest:e!==i}}reset(){this.sliderContainer.className="sliderContainer",this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.img.src=p(),this.draw()}}e.jigsaw={init:function(t){return new v(t).init()},reset:function(t){return new v(t).reset()}}})(window),jigsaw.init({el:document.getElementById("captcha"),onSuccess:function(){t.success(!0)},onFail:e,onRefresh:e})}}},c=r;n("7d2e");function a(t,e,n,i,s,o,r,c){var a,l="function"===typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=n,l._compiled=!0),i&&(l.functional=!0),o&&(l._scopeId="data-v-"+o),r?(a=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},l._ssrRegister=a):s&&(a=c?function(){s.call(this,this.$root.$options.shadowRoot)}:s),a)if(l.functional){l._injectStyles=a;var d=l.render;l.render=function(t,e){return a.call(e),d(t,e)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,a):[a]}return{exports:t,options:l}}var l=a(c,s,o,!1,null,null,null),d=l.exports;d.install=function(t){t.component(d.name,d)};var u=d;const h={},f=(t,e)=>{const n="water-mark-js";if(null===document.getElementById(e))return!1;if(null!==document.getElementById(n))return n;const i=document.createElement("canvas");i.width=150,i.height=120;const s=i.getContext("2d");s.rotate(-20*Math.PI/180),s.font="20px Vedana",s.fillStyle="rgba(200, 200, 200, 0.20)",s.textAlign="left",s.textBaseline="Middle",s.fillText(t,i.width/3,i.height/2);const o=document.createElement("div");o.id=n;const r={pointerEvents:"none",top:"100px",position:"fixed",zIndex:"99",width:document.getElementById(e).clientWidth+"px",height:document.getElementById(e).clientHeight+"px",background:"url("+i.toDataURL("image/png")+") left top repeat"};for(const c in r)o.style[c]=r[c];return document.getElementById(e).appendChild(o),[n,r]};h.set=(t,e)=>{const n=f(t,e);if(!n)return!1;const i=n[0],s=n[1],o=setInterval(()=>{if(null===document.getElementById(e)&&clearInterval(o),null===document.getElementById(i))f(t,e);else{document.getElementById(i).style="";for(const t in s)document.getElementById(i).style[t]=s[t];document.getElementById(i).className=""}},1e3);window.addEventListener("resize",()=>{s.width=document.getElementById(e).clientWidth+"px",s.height=document.getElementById(e).clientHeight+"px"})};var p=h;const m=[u],g=function(t){g.installed||m.forEach(e=>{t.component(e.name,e)})};"undefined"!==typeof window&&window.Vue&&g(window.Vue);var y={install:g};n.d(e,"LinshengjiCode",(function(){return u})),n.d(e,"warterMark",(function(){return p}));e["default"]=y},e67d:function(t,e){(function(t){var e="currentScript",n=t.getElementsByTagName("script");e in t||Object.defineProperty(t,e,{get:function(){try{throw new Error}catch(i){var t,e=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(i.stack)||[!1])[1];for(t in n)if(n[t].src==e||"interactive"==n[t].readyState)return n[t];return null}}})})(document)},f0d8:function(t,e,n){}})}));
//# sourceMappingURL=linshengji.umd.min.js.map